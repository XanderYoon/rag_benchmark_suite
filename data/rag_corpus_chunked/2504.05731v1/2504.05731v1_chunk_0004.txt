can only infer that “She” in the user’s input refers to “Hillary Clinton’‘. (b) The bottom shows results retrieved by our method from similar users’ histories, allowing us to infer further that “his” in the user’s input refers to “Donald Trump” thus enabling the generation of a more accurate result. our method, which retrieves documents from the history of similar users. In this case, we can further infer that “his” in the user’s input refers to “Donald Trump”, leading to a better generation result. From this example, we can see that incorporating collaborative in- formation allows the retrieval of more diverse documents, helping the LLM generate results that better meet the user’s needs. Inspired by the application of collaborative filtering in recom- mender systems [ 11, 40, 46], we propose to adapt collaborative information into RAG to personalize LLMs. However, adapting col- laborative filtering to personalized RAG presents two challenges. Challenge 1: How to incorporate collaborative information. With- out explicit labels indicating which users are similar, which users’ information should be selected to help personalize generation for the current user? Challenge 2: How to retrieve documents that support personalized LLM generation, rather than relying on tradi- tional semantic relevance? Pre-trained dense retrieval models [54] only retrieve based on the semantic relevance between the query and document. Directly using these models for retrieval may not necessarily result in content that allows the LLM to generate out- puts that meet the user’s needs [25, 35]. To address the above challenges, this paper proposes a method named CFRAG which adapts Collaborative Filtering to personal- ized Retrieval Augmented Generation. Firstly, to address Challenge 1, since there are no explicit user similarity labels, we use contrastive learning [15, 44] to train user embeddings for retrieving similar users to introduce collaborative information. Specifically, we apply different