_ i d s = set () while True : r u n _ s t a t u s = client . beta . threads . runs . retrieve ( run . id , th re ad _i d = m e s s a g e _ t h r e a d . id ) if r u n _ s t a t u s . status == ’ c om pl et ed ’: break elif r u n _ s t a t u s . status == ’ failed ’: raise E xc ep tio n ( f " Run failed : { r u n _ s t a t u s . error } " ) time . sleep (1) while True : r e s p o n s e _ m e s s a g e s = client . beta . threads . messages . list ( t hr ea d_ id = m e s s a g e _ t h r e a d . id ) n e w _ m e s s a g e s = [ msg for msg in r e s p o n s e _ m e s s a g e s . data if msg . id not in p r o c e s s e d _ m e s s a g e _ i d s ] for message in n e w _ m e s s a g e s : if message . role == " a ss is ta nt " and message . content : m e s s a g e _ c o n t e n t = message . content