a g e _ i d s ] for message in n e w _ m e s s a g e s : if message . role == " a ss is ta nt " and message . content : m e s s a g e _ c o n t e n t = message . content [0]. text a n n o t a t i o n s = m e s s a g e _ c o n t e n t . a n n o t a t i o n s for index , a n n o t a t i o n in en um er at e ( a n n o t a t i o n s ) : m e s s a g e _ c o n t e n t . value = m e s s a g e _ c o n t e n t . value . replace ( a n n o t a t i o n . text , f " [{ index }] " ) if f i l e _ c i t a t i o n := getattr ( annotation , " f i l e _ c i t a t i o n " , None ) : c i t e d _ f i l e = client . files . retrieve ( f i l e _ c i t a t i o n . file_id ) ci ta ti on s . append ( f " [{ index }] { c i t e d _ f i l e . filename } " ) words = m e s s a g