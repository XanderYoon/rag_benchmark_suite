for the reference image and use its embedding as the positive em- bedding in this stage. The embeddings are obtained by: fclean query =E t(Tq +C(I q)), fref passage =E t(Tp), fmultistage2 =E i(Ip) +E t(Tq +C(I p)), (3) whereT q andT p are the user text query and retrieved refer- ence text knowledge respectively. The contrastive learning of the second stage is designed as shown in Equation 4: LR ←max (∥clean sim−β·ref sim∥+γ,0), clean sim←sim(f multistage2 , fclean query ), ref sim←sim(f multistage2 , fref passage). (4) The detailed process of the second stage is shown in Al- gorithm 2. Building on the perturbation generated in the first stage, the second stage iteratively refines and outputs the final perturbation. With the two-stage hierarchical strategy, we obtain the final retrieval perturbation added to the query image and re- trieve the adversarial augmented knowledge. The genera- tor’s disrupted query is obtained by adding noise generated by advanced attack method on LMMs to the image. The two inputs that misalign with each other achieve the hierarchical attack on MRAG pipeline. Algorithm 2Semantic Alignment Attack (Stage 2) Input:Perturbationδ r1 from first stage, user imageI q, User text queryT q, reference positive passageT p, mod- elsE i, Et,Cand hyperparameterss, α, ϵ, β, γthe same as stage 1. Output:Final Perturbationδ r 1:Get reference positive passage embedding: fref passage ←E t(Tp) 2:Get clean query text embedding:f clean query ← Et(Tq +C(I q)) 3:Initialize perturbationδ r ←δ r1 4:Initialize perturbed imageI p ←I q +δ r 5:forstep←1tosdo 6:I p ←I q +δ r 7:f multistage2 ←E i(Ip) +E t(Tq +C(I p)) 8:clean sim←sim(f multistage2 , fclean query ) 9:ref sim←sim(f multistage2 , fref passage) 10:L R ←max (∥clean sim−β·ref sim∥+γ,0), 11:Optimizeδ r ←δ r −α·sign(∇ δr LR) 12:δ r ←Clip(δ r,−ϵ, ϵ) 13:end for Returnδ r 4.